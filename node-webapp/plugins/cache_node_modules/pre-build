#!/bin/bash
set -e
set -x

# Cache node_modules. Symlink `node_modules` directories to a peristent cache
# dir so that they are kept when container is destroyed.

# Read the command.
PLUGIN_DIR=`dirname $0`
CMD=$(<${PLUGIN_DIR}/command)

. PLUGIN_DIR/../common.sh

echo "\t Running cache-node-modules pre-build hook for ${IMAGE_TAG_BUILD} ..."


CONTAINER=$( \                                                                     
  $DOCKER run -d \                                                                 
  ${DOCKER_DEFAULT_OPTS} ${docker_opts} \                                          
  ${IMAGE_TAG_BUILD} \                                                             
  /bin/bash -c "${CMD}")

${DOCKER} attach ${CONTAINER}                                                      
${DOCKER} wait ${CONTAINER}                                                        
${DOCKER} commit ${CONTAINER} ${IMAGE_TAG_BUILD}    


